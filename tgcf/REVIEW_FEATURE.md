# 用户评价功能说明

## 功能概述

在首页作品评价区域添加了用户评价功能，用户可以提交评价，管理员审核后在首页显示。

## 新增功能

### 1. 用户端功能

#### 首页评价区域
- 在作品评价section最下方添加了"读者评价"区域
- 显示已审核通过的用户评价（最多5条）
- 提供"写评价"按钮链接到评价表单页面

#### 独立评价页面 (`review-form.html`)
- 完整的评价提交表单
- 包含昵称、星级评分、评价内容输入
- 实时字数统计（最多500字）
- 星级评分交互效果
- 显示所有已审核的评价列表

### 2. 管理员端功能

#### 作品评价管理
- 查看所有评价（待审核、已审核、已拒绝）
- 评价状态标识（待审核/已审核/已拒绝）
- 评价内容预览（超过50字显示省略号）
- 审核操作：通过/拒绝
- 查看评价详情（弹窗显示完整信息）
- 删除评价功能
- 批量删除功能

## 技术实现

### 数据库
使用现有的 `work_reviews` 表，包含以下字段：
- `id`: 评价ID
- `username`: 用户昵称
- `rating`: 评分（1-5星）
- `content`: 评价内容
- `status`: 状态（pending/approved/rejected）
- `create_time`: 创建时间
- `update_time`: 更新时间

### API接口

#### 用户接口
- `GET /api/user/review` - 获取已审核的评价列表
- `POST /api/user/review` - 提交新评价

#### 管理员接口
- `GET /api/admin/review` - 获取所有评价
- `GET /api/admin/review/:id` - 获取单个评价详情
- `PUT /api/admin/review/:id/status` - 更新评价状态
- `DELETE /api/admin/review/:id` - 删除评价

### 前端功能
- 星级评分组件
- 实时字数统计
- 响应式设计
- 评价列表渲染
- 管理员审核界面

## 使用流程

### 用户提交评价
1. 用户在首页点击"写评价"按钮
2. 跳转到评价表单页面
3. 填写昵称、选择评分、输入评价内容
4. 提交后评价进入待审核状态
5. 显示"评价提交成功，等待审核后显示"提示

### 管理员审核
1. 管理员登录后台管理系统
2. 进入"作品评价"管理页面
3. 查看待审核的评价列表
4. 点击"查看"按钮查看评价详情
5. 选择"通过"或"拒绝"审核
6. 通过审核的评价会在首页显示

## 文件说明

### 新增文件
- `user-web/review-form.html` - 独立的评价表单页面
- `test-review-api.html` - API功能测试页面
- `REVIEW_FEATURE.md` - 功能说明文档

### 修改文件
- `user-web/天官赐福首页.html` - 添加评价显示区域和相关功能
- `admin-web/admin.html` - 优化评价管理功能
- `node-backend/api/admin.routes.js` - 添加获取单个评价详情的API

## 测试方法

1. 启动后端服务：`cd node-backend && npm start`
2. 打开 `test-review-api.html` 测试API功能
3. 访问 `user-web/review-form.html` 测试用户评价功能
4. 访问 `admin-web/admin.html` 测试管理员审核功能

## 特色功能

1. **审核机制**: 用户提交的评价需要管理员审核后才能在首页显示
2. **星级评分**: 直观的5星评分系统
3. **响应式设计**: 适配各种屏幕尺寸
4. **实时反馈**: 字数统计、提交状态提示
5. **管理便捷**: 管理员可以批量管理评价

## 安全考虑

1. 输入验证：昵称长度限制、评价内容长度限制
2. HTML转义：防止XSS攻击
3. 权限控制：管理员功能需要登录验证
4. 状态管理：评价状态严格控制

这个功能完整实现了用户评价的提交、审核、显示流程，提供了良好的用户体验和管理体验。