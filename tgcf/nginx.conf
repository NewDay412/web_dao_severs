# 事件配置
events {
    worker_connections 1024;
}

# Gzip压缩配置
http {
    gzip on;
    gzip_comp_level 6;
    gzip_min_length 1000;
    gzip_proxied any;
    gzip_vary on;
    gzip_types
        text/plain
        text/css
        text/javascript
        application/javascript
        application/json
        application/xml
        image/svg+xml
        application/vnd.ms-fontobject
        font/ttf
        font/opentype
        font/x-woff;
    gzip_disable "msie6";
    gzip_buffers 16 8k;

    server {
        listen 80;
        server_name dao.longlong.baby longlong.baby longlong.baby1 47.83.203.60;
    
    # 设置客户端请求体最大大小（支持文件上传）
    client_max_body_size 10M;
    
    # 静态文件服务
    location / {
        proxy_pass http://localhost:3003;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # API接口代理
    location /api/ {
        proxy_pass http://localhost:3003;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # 上传文件静态服务
    location /uploads/ {
        root /var/www/tgcf/node-backend/uploads;
        expires 1y;
        add_header Cache-Control "public, immutable, max-age=31536000";
        add_header Vary Accept-Encoding;
        
        # 如果文件不存在，返回404而不是代理到后端
        try_files $uri =404;
    }
    
    # 静态资源缓存 - 长期缓存配置
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|eot|mp4|webm|ogg|mp3|wav|flac|aac|pdf)$ {
        proxy_pass http://localhost:3003;
        expires 1y;
        add_header Cache-Control "public, immutable, max-age=31536000";
        add_header Vary Accept-Encoding;
    }
}

# HTTPS配置（可选）
# server {
#     listen 443 ssl;
#     server_name dao.longlong.baby longlong.baby;
#     
#     # SSL证书配置（需要申请SSL证书）
    # ssl_certificate /path/to/certificate.crt;
    # ssl_certificate_key /path/to/private.key;
    
    # location / {
    #     proxy_pass http://localhost:3003;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }
# }
}